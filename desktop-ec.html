
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Desktop users Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
        <link rel="stylesheet" href="styles/website.css">
        
    

    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="laptop-ec.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Fixing ECs
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Patches</li>
        
        
    
        <li class="chapter active" data-level="2.1" data-path="desktop-ec.html">
            
                <a href="desktop-ec.html">
            
                    
                    Desktop users
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="laptop-ec.html">
            
                <a href="laptop-ec.html">
            
                    
                    Laptops users
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Desktop users</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="fixing-desktop-ecs">Fixing Desktop ECs</h1>
<h1 id="the-easy-way">The easy way</h1>
<p>Open SSDTTime on the machine in either Windows or Linux, and run the following:</p>
<ul>
<li>Dump DSDT</li>
<li>Fake EC</li>
</ul>
<p>After running both options, you&apos;ll be provided with <code>SSDT-EC.aml</code>. The .aml is super important as this is the compiled version, .dsl is decompiled and can be seen as source code.</p>
<p>Adding to Clover:</p>
<ul>
<li>EFI/CLOVER/API/patched</li>
</ul>
<p>Adding to OpenCore:</p>
<ul>
<li>EFI/OC/ACPI</li>
<li>config.plist -&gt; ACPI -&gt; Add</li>
</ul>
<h1 id="the-long-way">The long way</h1>
<p>Having issues with SSDTTime or wanna learn the process? Well continue on!</p>
<h2 id="getting-a-copy-of-your-dsdt">Getting a copy of your DSDT</h2>
<p>So to get a copy of your DSDT there&apos;s a couple of options:</p>
<ul>
<li><a href="https://github.com/acidanthera/MaciASL/releases" target="_blank">MaciASL</a><ul>
<li>Open the app on the target machine and the system&apos;s DSDT will show, then File -&gt; SaveAs <code>System DSDT</code>. Make sure the file format is ACPI Machine Language Binary(.AML), this will require the machine to be running macOS</li>
<li>Do note that all ACPI patches from clover/OpenCore will be applied to the DSDT</li>
</ul>
</li>
<li><a href="https://github.com/corpnewt/SSDTTime" target="_blank">SSDTTime</a><ul>
<li>Supports both Windows and Linux for DSDT dumping</li>
</ul>
</li>
<li><a href="https://acpica.org/sites/acpica/files/iasl-win-20180105.zip" target="_blank">acpidump.exe</a><ul>
<li>In command prompt run <code>path/to/acpidump.exe -b -n DSDT -z</code>, this will dump your DSDT as a .dat file. Rename this to DSDT.aml</li>
</ul>
</li>
<li>F4 in Clover Boot menu<ul>
<li>DSDT can be found in <code>EFI/CLOVER/ACPI/origin</code>, the folder <strong>must</strong> exist before dumping</li>
</ul>
</li>
<li><a href="https://github.com/khronokernel/Opencore-Vanilla-Desktop-Guide/tree/master/extra-files/acpidump.efi.zip" target="_blank"><code>acpidump.efi</code></a><ul>
<li>For OpenCore only, add this to <code>EFI/OC/Tools</code> and in your config under <code>Misc -&gt; Tools</code> with the argument: <code>-b -n DSDT -z</code> and select this option in OpenCore&apos;s picker. Rename the DSDT.dat to DSDT.aml. Tool is provided by <a href="https://github.com/acpica/acpica/tree/master/source/tools/acpidump" target="_blank">acpica</a></li>
</ul>
</li>
</ul>
<p>If OpenCore is having issues running acpidump, you can call it from the shell with <a href="https://github.com/acidanthera/OpenCoreShell/releases" target="_blank">OpenCoreShell</a>(reminder to add to both <code>EFI/OC/Tools</code> and in your config under <code>Misc -&gt; Tools</code> ):</p>
<pre><code class="lang-text">shell&gt; fs0: // replace with proper drive

fs0:\&gt; dir // to verify this is the right directory

Directory of fs0:\

01/01/01 3:30p EFI

fs0:\&gt; cd EFI\OC\Tools // note that it&apos;s with forward slashes

fs0:\EFI\OC\Tools&gt; acpidump.efi -b -n DSDT -z
</code></pre>
<h2 id="decompiling-the-dsdt">Decompiling the DSDT</h2>
<p>So once we have our DSDT we still got a bit of work left, we&apos;ll first want to decompile it so we can view it easier. Couple options:</p>
<h3 id="macos">macOS</h3>
<p>So decompiling DSDTs is quite easy with macOS, all you need is <a href="https://github.com/acidanthera/MaciASL" target="_blank">MaciASL</a>. To decompile, just open the file!</p>
<h3 id="windows">Windows</h3>
<p>Decompiling on windows is fairly simple as well, you will need <a href="https://acpica.org/sites/acpica/files/iasl-win-20180105.zip" target="_blank">iasl.exe</a> and Command Prompt:</p>
<pre><code class="lang-text">path/to/iasl.exe path/to/DSDT.aml
</code></pre>
<p><img src="https://cdn.discordapp.com/attachments/456913818467958789/668211002340409404/unknown.png" alt=""></p>
<h3 id="linux">Linux</h3>
<p>Compiling and decompiling with Linux is just as simple, you will need a special copy of <a href="http://amdosx.kellynet.nl/iasl.zip" target="_blank">iasl</a> and terminal:</p>
<pre><code class="lang-text">path/to/iasl path/to/DSDT.aml
</code></pre>
<h2 id="creating-ssdts">Creating SSDTs</h2>
<p>This one&apos;s fairly easy to figure out, open your decompiled DSDT and search for <code>PNP0C09</code>. This should give you a result like this:</p>
<p><img src="https://i.imgur.com/lQ4kpb9.png" alt=""></p>
<p>As you can see our <code>PNP0C09</code> is found within the <code>Device (EC0)</code> meaning this is the device we want to hide from macOS(others may find ). Now grab our SSDT-EC and uncomment the EC0 function(remove the <code>/*</code> and <code>*/</code> around it):</p>
<ul>
<li><a href="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/SSDT-EC-USBX.dsl" target="_blank">SSDT-EC-USBX</a><ul>
<li>For Skylake+ and all AMD systems</li>
</ul>
</li>
<li><a href="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/AcpiSamples/SSDT-EC.dsl" target="_blank">SSDT-EC</a><ul>
<li>For Haswell and older</li>
</ul>
</li>
</ul>
<pre><code class="lang-text">/* &lt;- REMOVE THIS
External (_SB_.PCI0.LPCB.EC0, DeviceObj)

   Scope (\_SB.PCI0.LPCB.EC0)
   {   
      Method (_STA, 0, NotSerialized) // _STA: Status
      {
         If (_OSI (&quot;Darwin&quot;))
         {
            Return (0)
         }
         Else
      {
      Return (0x0F)
     }
  }
}
*/ &lt;- REMOVE THIS
</code></pre>
<p>But looking back at the screenshot above we notice something, our ACPI path is different: <code>PC00.LPC0</code> vs <code>PCI0.LPCB</code>. This is very important especially when you&apos;re dealing with Intel consumer vs Intel HEDT and AMD, <code>PC00.LPC0</code> is common on Intel HEDT while <code>PCI0.SBRG</code> is common on AMD. And they even come with name variation such as  <code>EC0</code>, <code>H_EC</code>, <code>PGEC</code> and <code>ECDV</code>, so there can&apos;t be a one size fits all SSDT, <strong>always verify your path and device</strong>.</p>
<p>And make sure to scroll to the bottom as the new Fake EC function also need the correct path to replace the old EC.</p>
<blockquote>
<p>What happens if multiple <code>PNP0C09</code> show up</p>
</blockquote>
<p>When this happens you need to figure out which is the main and which is not, it&apos;s fairly easy to figure out. Check each controller for the following properties:</p>
<ul>
<li><code>_HID</code></li>
<li><code>_CRS</code></li>
<li><code>_GPE</code></li>
</ul>
<blockquote>
<p>What happens if no <code>PNP0C09</code> show up?</p>
</blockquote>
<p>This means your SSDT can be <em>almost</em> complied, the main thing to watch for is whether your DSDT uses <code>PCI0.LPCB</code> or not. The reason being is that we have a FakeEC at the bottom of our SSDT that needs to connect properly into our DSDT. Gernally AMD uses <code>SBRG</code> while Intel HEDT use <code>LPC0</code>, <strong>verify which show up in your DSDT</strong>. Once you find out, change <code>PCI0.LPCB</code> to your correct path:</p>
<pre><code class="lang-text">Scope (\_SB.PCI0.LPCB)
{
    Device (EC)
    {
        Name (_HID, &quot;ACID0001&quot;)  // _HID: Hardware ID
        Method (_STA, 0, NotSerialized)  // _STA: Status
        {
            If (_OSI (&quot;Darwin&quot;))
            {
                Return (0x0F)
            }
            Else
            {
                Return (Zero)
            }
        }
    }
}
</code></pre>
<blockquote>
<p>Hey what about USBX? Do I need to do anything?</p>
</blockquote>
<p>USBX is universal across all systems, it just creates a USBX device that forces USB power properties. This is crucial for fixing Mics, DACs, Webcams, Bluetooth Dongles and other high power draw devices. This is not mandatory to boot but should be added in post-install if not before. Note that USBX is only used on skylake+ systems, Broadwell and older can ignore and that USBX requires a patched EC to function correctly</p>
<h2 id="adding-your-ssdt">Adding your SSDT</h2>
<p>Adding to Clover:</p>
<ul>
<li>EFI/CLOVER/API/patched</li>
</ul>
<p>Adding to OpenCore:</p>
<ul>
<li>EFI/OC/ACPI</li>
<li>config.plist -&gt; ACPI -&gt; Add</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Fixing ECs">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="laptop-ec.html" class="navigation navigation-next " aria-label="Next page: Laptops users">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Desktop users","level":"2.1","depth":1,"next":{"title":"Laptops users","level":"2.2","depth":1,"path":"laptop-ec.md","ref":"laptop-ec.md","articles":[]},"previous":{"title":"Fixing ECs","level":"1.1","depth":1,"path":"README.md","ref":"README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["theme-default","-lunr","-search","search-plus","addcssjs","favicon-plus"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"output":"_book","addcssjs":{"css":[],"js":[]},"fontsettings":{"theme":"night","family":"sans","size":2},"favicon-plus":{"appleTouchIconPrecomposed152":"","favicon":"","output":"_book"},"highlight":{},"favicon":"/icons/favicon.ico","appleTouchIconPrecomposed152":"/icons/appleTouchIconPrecomposed152.png","sharing":{"facebook":false,"twitter":false,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":[]},"theme-default":{"showLevel":false,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"search-plus":{}},"theme":"default","pdf":{"pageBreaksBefore":"/","headerTemplate":null,"paperSize":"a4","margin":{"right":62,"left":62,"top":36,"bottom":36},"fontSize":12,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"links":{"sharing":{"google":false,"facebook":false,"twitter":false,"weibo":false,"all":false}},"gitbook":"*"},"file":{"path":"desktop-ec.md","mtime":"2020-01-20T05:17:38.256Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-01-20T05:18:20.410Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    

    </body>
</html>

